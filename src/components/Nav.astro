---
const currentPath = Astro.url.pathname;
const links = [
  { href: '/', label: 'Home' },
  { href: '/services', label: 'Services' },
  { href: '/about', label: 'About' },
  { href: '/contact', label: 'Contact' },
];
---

<nav id="main-nav" class="fixed top-0 left-0 right-0 z-50 transition-all duration-300">
  <div class="max-w-6xl mx-auto px-4 md:px-8 flex items-center justify-between h-20">
    <!-- Logo: text wordmark -->
    <a href="/" class="flex items-baseline gap-1 group">
      <span class="font-serif text-2xl nav-logo-text transition-colors duration-300 tracking-tight">SUITE MANAGER</span>
      <span class="nav-logo-llc text-[0.65rem] font-sans font-light tracking-widest uppercase transition-colors duration-300">LLC</span>
    </a>

    <!-- Desktop Links -->
    <div class="hidden md:flex items-center gap-8">
      {links.map(link => (
        <a
          href={link.href}
          class:list={[
            'nav-link text-sm font-medium tracking-wide uppercase transition-colors duration-300',
            currentPath === link.href ? 'nav-link-active' : '',
          ]}
        >
          {link.label}
        </a>
      ))}
      <a href="/contact" class="btn-primary text-sm !px-6 !py-2.5">
        Let's Talk
        <span class="btn-arrow-icon ml-1">&rarr;</span>
      </a>
    </div>

    <!-- Mobile Menu Button -->
    <button id="mobile-menu-btn" class="md:hidden p-2" aria-label="Open menu">
      <svg class="w-6 h-6 nav-icon transition-colors duration-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
      </svg>
    </button>
  </div>

  <!-- Gold progress bar -->
  <div class="nav-progress-bar" id="nav-progress"></div>

  <!-- Mobile Menu -->
  <div id="mobile-menu" class="hidden md:hidden bg-white border-t border-border">
    <div class="px-4 py-6 flex flex-col gap-4">
      {links.map(link => (
        <a
          href={link.href}
          class:list={[
            'text-navy text-lg font-medium py-2',
            currentPath === link.href ? 'text-gold' : '',
          ]}
        >
          {link.label}
        </a>
      ))}
      <a href="/contact" class="btn-primary text-center mt-2">Let's Talk</a>
    </div>
  </div>
</nav>

<style>
  /* Default: transparent nav for dark hero pages */
  #main-nav {
    background: transparent;
  }
  #main-nav .nav-logo-text {
    color: white;
  }
  #main-nav .nav-logo-llc {
    color: rgba(255, 255, 255, 0.5);
  }
  #main-nav .nav-link {
    color: rgba(255, 255, 255, 0.8);
  }
  #main-nav .nav-link:hover,
  #main-nav .nav-link-active {
    color: #B8955A;
  }
  #main-nav .nav-icon {
    color: white;
  }

  /* Scrolled state: solid white background */
  #main-nav.scrolled {
    background: rgba(255, 255, 255, 0.97);
    backdrop-filter: blur(8px);
    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.08);
  }
  #main-nav.scrolled .nav-logo-text {
    color: #1A1A2E;
  }
  #main-nav.scrolled .nav-logo-llc {
    color: #6B6B7B;
  }
  #main-nav.scrolled .nav-link {
    color: #6B6B7B;
  }
  #main-nav.scrolled .nav-link:hover,
  #main-nav.scrolled .nav-link-active {
    color: #B8955A;
  }
  #main-nav.scrolled .nav-icon {
    color: #1A1A2E;
  }

  /* Light nav variant (for pages with cream hero) */
  :global(.nav-light) #main-nav {
    background: transparent;
  }
  :global(.nav-light) #main-nav .nav-logo-text {
    color: #1A1A2E;
  }
  :global(.nav-light) #main-nav .nav-logo-llc {
    color: #6B6B7B;
  }
  :global(.nav-light) #main-nav .nav-link {
    color: #6B6B7B;
  }
  :global(.nav-light) #main-nav .nav-link:hover,
  :global(.nav-light) #main-nav .nav-link-active {
    color: #B8955A;
  }
  :global(.nav-light) #main-nav .nav-icon {
    color: #1A1A2E;
  }
</style>

<script>
  // Scroll behavior: transparent to solid
  const nav = document.getElementById('main-nav');
  const progress = document.getElementById('nav-progress');

  function handleScroll() {
    if (window.scrollY > 60) {
      nav?.classList.add('scrolled');
    } else {
      nav?.classList.remove('scrolled');
    }

    // Update progress bar
    if (progress) {
      const scrollTop = window.scrollY;
      const docHeight = document.documentElement.scrollHeight - window.innerHeight;
      const scrollPercent = docHeight > 0 ? (scrollTop / docHeight) * 100 : 0;
      progress.style.width = scrollPercent + '%';
    }
  }
  window.addEventListener('scroll', handleScroll, { passive: true });
  handleScroll();

  // Mobile menu toggle
  const btn = document.getElementById('mobile-menu-btn');
  const menu = document.getElementById('mobile-menu');
  btn?.addEventListener('click', () => {
    menu?.classList.toggle('hidden');
  });
</script>
